
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L' Brothers - Est√©tica Automotiva Premium</title>
    <meta name="description" content="Est√©tica automotiva premium em S√£o Paulo. Agendamento online, lavagem, polimento e detalhamento profissional.">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Supabase Client -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <!-- Chart.js para an√°lises -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chart.js/3.9.1/chart.min.js"></script>
    <!-- EmailJS -->
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }
        .service-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        
        /* FIX: Floating labels apenas dentro de input-container */
        .input-container {
            position: relative;
            margin-bottom: 20px;
        }
        
        .input-container .floating-label {
            position: absolute;
            pointer-events: none;
            left: 12px;
            top: 12px;
            transition: 0.2s ease all;
            color: #9ca3af;
            font-size: 14px;
            background: transparent;
        }
        
        .input-container input:focus ~ .floating-label,
        .input-container input:not(:placeholder-shown) ~ .floating-label,
        .input-container textarea:focus ~ .floating-label,
        .input-container textarea:not(:placeholder-shown) ~ .floating-label {
            top: -8px;
            left: 10px;
            font-size: 12px;
            background: white;
            padding: 0 5px;
            color: #3b82f6;
        }
        
        /* Prevenir floating labels fora de containers */
        body > .floating-label,
        .floating-label:not(.input-container .floating-label) {
            display: none !important;
        }
        
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .loading {
            display: none;
        }
        .loading.active {
            display: inline-block;
        }
        .success-message {
            background: #10b981;
            color: white;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }
        .error-message {
            background: #ef4444;
            color: white;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }
        .spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 2s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .admin-panel {
            display: none;
        }
        .admin-panel.active {
            display: block;
        }
        .dashboard-card {
            background: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .status-agendado { background: #dbeafe; color: #1e40af; }
        .status-confirmado { background: #d1fae5; color: #065f46; }
        .status-concluido { background: #f3f4f6; color: #374151; }
        .status-cancelado { background: #fecaca; color: #991b1b; }
    </style>
</head>
<body class="font-sans bg-gray-100">
    
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-2">
                    <i class="fas fa-car-side text-3xl text-blue-400" aria-hidden="true"></i>
                    <span class="text-2xl font-bold text-white">L' Brothers</span>
                </div>
        
                <nav class="hidden md:flex space-x-8" role="navigation">
                    <a href="#services" class="hover:text-blue-300 transition">Servi√ßos</a>
                    <a href="#about" class="hover:text-blue-300 transition">Sobre N√≥s</a>
                    <a href="#contact" class="hover:text-blue-300 transition">Contato</a>
                    <a href="#analytics" class="hover:text-blue-300 transition">An√°lises</a>
                    
                    <div id="user-menu-logged-out">
                        <button onclick="openModal('loginModal')" class="bg-blue-500 hover:bg-blue-600 px-4 py-2 rounded-full transition">
                            √Årea do Cliente
                        </button>
                        <button onclick="openModal('adminLoginModal')" class="bg-purple-500 hover:bg-purple-600 px-4 py-2 rounded-full transition">
                            Admin
                        </button>
                    </div>
                    
                    <div id="user-menu-logged-in" class="hidden">
                        <span id="user-name" class="mr-4"></span>
                        <button onclick="toggleUserDashboard()" class="bg-green-500 hover:bg-green-600 px-4 py-2 rounded-full transition">
                            Dashboard
                        </button>
                        <button onclick="logout()" class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded-full transition">
                            Sair
                        </button>
                    </div>
                </nav>

                <button class="md:hidden text-2xl" onclick="toggleMobileMenu()">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- User Dashboard -->
    <div id="userDashboard" class="hidden bg-white shadow-lg border-b">
        <div class="container mx-auto px-4 py-6">
            <h2 class="text-2xl font-bold mb-4">Meus Agendamentos</h2>
            <div id="user-appointments" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Appointments will be loaded here -->
            </div>
            
            <div class="mt-6">
                <button onclick="openModal('scheduleModal')" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg transition">
                    Novo Agendamento
                </button>
            </div>
        </div>
    </div>

    <!-- Admin Panel -->
    <div id="adminPanel" class="admin-panel bg-gray-50">
        <div class="container mx-auto px-4 py-8">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold">Painel Administrativo</h2>
                <button onclick="toggleAdminPanel()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg">
                    Fechar Painel
                </button>
            </div>
            
            <!-- Dashboard Stats -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="dashboard-card">
                    <h3 class="text-lg font-semibold text-gray-700">Total Agendamentos</h3>
                    <p id="total-appointments" class="text-3xl font-bold text-blue-600">0</p>
                </div>
                <div class="dashboard-card">
                    <h3 class="text-lg font-semibold text-gray-700">Agendamentos Hoje</h3>
                    <p id="today-appointments" class="text-3xl font-bold text-green-600">0</p>
                </div>
                <div class="dashboard-card">
                    <h3 class="text-lg font-semibold text-gray-700">Total Clientes</h3>
                    <p id="total-users" class="text-3xl font-bold text-purple-600">0</p>
                </div>
                <div class="dashboard-card">
                    <h3 class="text-lg font-semibold text-gray-700">Mensagens</h3>
                    <p id="total-contacts" class="text-3xl font-bold text-yellow-600">0</p>
                </div>
            </div>
            
            <!-- Appointments Management -->
            <div class="dashboard-card mb-8">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-bold">Gerenciar Agendamentos</h3>
                    <button onclick="refreshAppointments()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg">
                        <i class="fas fa-refresh mr-2"></i>Atualizar
                    </button>
                </div>
                <div id="admin-appointments" class="overflow-x-auto">
                    <!-- Appointments table will be loaded here -->
                </div>
            </div>
            
            <!-- Analytics -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <div class="dashboard-card">
                    <h3 class="text-xl font-bold mb-4">Servi√ßos Mais Solicitados</h3>
                    <canvas id="servicesChart" width="400" height="200"></canvas>
                </div>
                <div class="dashboard-card">
                    <h3 class="text-xl font-bold mb-4">Agendamentos por M√™s</h3>
                    <canvas id="monthlyChart" width="400" height="200"></canvas>
                </div>
            </div>
            
            <!-- Contacts Management -->
            <div class="dashboard-card">
                <h3 class="text-xl font-bold mb-4">Mensagens de Contato</h3>
                <div id="admin-contacts" class="space-y-4">
                    <!-- Contacts will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Hero Section -->
    <section class="gradient-bg text-white py-20">
        <div class="container mx-auto px-4 flex flex-col md:flex-row items-center">
            <div class="md:w-1/2 mb-10 md:mb-0">
                <h1 class="text-4xl md:text-5xl font-bold mb-6">Transforme seu ve√≠culo em uma obra de arte</h1>
                <p class="text-xl mb-8 text-gray-300">Na L' Brothers, cuidamos do seu carro como se fosse nosso. Servi√ßos premium de est√©tica automotiva para deixar seu ve√≠culo impec√°vel.</p>
                <div class="flex space-x-4">
                    <button onclick="openModal('loginModal')" class="bg-blue-500 hover:bg-blue-600 px-6 py-3 rounded-full font-medium transition">Agendar Servi√ßo</button>
                    <button onclick="openModal('servicesModal')" class="bg-transparent border-2 border-white hover:bg-white hover:text-gray-900 px-6 py-3 rounded-full font-medium transition">Nossos Servi√ßos</button>
                </div>
            </div>
            <div class="md:w-1/2 flex justify-center">
                <img src="https://thumbs.dreamstime.com/b/fechamento-da-roda-do-carro-sendo-lavada-em-um-detalhador-autom%C3%A1tico-processo-detalhado-de-assist%C3%AAncia-captado-arm%C3%A1rio-309647328.jpg?w=992" 
                     alt="Processo de lavagem profissional de ve√≠culo" 
                     class="rounded-lg shadow-2xl max-w-full h-auto">
            </div>
        </div>
    </section>

    <!-- Services Section -->
    <section id="services" class="py-16 bg-white">
        <div class="container mx-auto px-4">
            <h2 class="text-3xl font-bold text-center mb-12">Nossos Servi√ßos Premium</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="service-card bg-white rounded-lg shadow-md overflow-hidden transition duration-300">
                    <div class="h-48 overflow-hidden">
                        <img src="https://images.unsplash.com/photo-1607860108855-64acf2078ed9?ixlib=rb-4.0.3&auto=format&fit=crop&w=1470&q=80" alt="Lavagem Premium" class="w-full h-full object-cover">
                    </div>
                    <div class="p-6">
                        <h3 class="text-xl font-semibold mb-2">Lavagem Premium</h3>
                        <p class="text-gray-600 mb-4">Lavagem completa com produtos importados e acabamento perfeito.</p>
                        <div class="flex justify-between items-center">
                            <span class="text-blue-500 font-bold">R$ 120 - R$ 250</span>
                            <button onclick="scheduleService('lavagem-premium')" class="text-blue-500 hover:text-blue-700 font-medium">Agendar</button>
                        </div>
                    </div>
                </div>
                
                <div class="service-card bg-white rounded-lg shadow-md overflow-hidden transition duration-300">
                    <div class="h-48 overflow-hidden">
                        <img src="https://images.unsplash.com/photo-1605559424843-9e4c228bf1c2?ixlib=rb-4.0.3&auto=format&fit=crop&w=1528&q=80" alt="Polimento" class="w-full h-full object-cover">
                    </div>
                    <div class="p-6">
                        <h3 class="text-xl font-semibold mb-2">Polimento Cristalizado</h3>
                        <p class="text-gray-600 mb-4">Remo√ß√£o de riscos e imperfei√ß√µes, prote√ß√£o duradoura.</p>
                        <div class="flex justify-between items-center">
                            <span class="text-blue-500 font-bold">R$ 350 - R$ 600</span>
                            <button onclick="scheduleService('polimento-cristalizado')" class="text-blue-500 hover:text-blue-700 font-medium">Agendar</button>
                        </div>
                    </div>
                </div>
                
                <div class="service-card bg-white rounded-lg shadow-md overflow-hidden transition duration-300">
                    <div class="h-48 overflow-hidden">
                        <img src="https://images.unsplash.com/photo-1568605117036-5fe5e7bab0b7?ixlib=rb-4.0.3&auto=format&fit=crop&w=1470&q=80" alt="Detalhamento" class="w-full h-full object-cover">
                    </div>
                    <div class="p-6">
                        <h3 class="text-xl font-semibold mb-2">Detalhamento Interno</h3>
                        <p class="text-gray-600 mb-4">Limpeza profunda com higieniza√ß√£o completa.</p>
                        <div class="flex justify-between items-center">
                            <span class="text-blue-500 font-bold">R$ 250 - R$ 400</span>
                            <button onclick="scheduleService('detalhamento-interno')" class="text-blue-500 hover:text-blue-700 font-medium">Agendar</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section id="about" class="py-16 bg-gray-100">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row items-center">
                <div class="md:w-1/2 mb-10 md:mb-0 md:pr-10">
                    <h2 class="text-3xl font-bold mb-6">Sobre a L' Brothers</h2>
                    <p class="text-gray-700 mb-4">Fundada em 2020 por dois irm√£os apaixonados por carros, a L' Brothers nasceu com o objetivo de oferecer servi√ßos de est√©tica automotiva com padr√£o de excel√™ncia.</p>
                    <p class="text-gray-700 mb-4">Com profissionais altamente qualificados e equipamentos de √∫ltima gera√ß√£o, garantimos resultados que superam as expectativas dos nossos clientes.</p>
                    <p class="text-gray-700 mb-6">Nossa miss√£o √© preservar e real√ßar a beleza do seu ve√≠culo, utilizando apenas produtos premium e t√©cnicas avan√ßadas de trabalho.</p>
                    <div class="flex space-x-4">
                        <div class="bg-white p-4 rounded-lg shadow-md text-center">
                            <div class="text-blue-500 text-3xl mb-2" aria-hidden="true">
                                <i class="fas fa-car"></i>
                            </div>
                            <h3 class="font-semibold">+700</h3>
                            <p class="text-sm text-gray-600">Ve√≠culos atendidos</p>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow-md text-center">
                            <div class="text-blue-500 text-3xl mb-2" aria-hidden="true">
                                <i class="fas fa-star"></i>
                            </div>
                            <h3 class="font-semibold">4.9/5</h3>
                            <p class="text-sm text-gray-600">Avalia√ß√£o m√©dia</p>
                        </div>
                        <div class="bg-white p-4 rounded-lg shadow-md text-center">
                            <div class="text-blue-500 text-3xl mb-2" aria-hidden="true">
                                <i class="fas fa-user-tie"></i>
                            </div>
                            <h3 class="font-semibold">2</h3>
                            <p class="text-sm text-gray-600">Profissionais</p>
                        </div>
                    </div>
                </div>
                <div class="md:w-1/2">
                    <div class="relative">
                        <img src="https://images.unsplash.com/photo-1558618047-3c8c76ca7d13?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80" alt="Equipe profissional da L' Brothers" class="rounded-lg shadow-xl w-full">
                        <div class="absolute -bottom-6 -right-6 bg-blue-500 text-white p-6 rounded-lg shadow-lg">
                            <h3 class="text-xl font-bold mb-2">5 anos</h3>
                            <p class="text-sm">de excel√™ncia em est√©tica automotiva</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Analytics Section -->
    <section id="analytics" class="py-16 bg-white">
        <div class="container mx-auto px-4">
            <h2 class="text-3xl font-bold text-center mb-12">An√°lise de Dados</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-gray-50 p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-bold mb-4">Estat√≠sticas P√∫blicas</h3>
                    <div class="space-y-4">
                        <div class="flex justify-between">
                            <span>Clientes Atendidos:</span>
                            <span class="font-bold" id="public-clients">700+</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Avalia√ß√£o M√©dia:</span>
                            <span class="font-bold text-yellow-500" id="public-rating">4.9/5</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Servi√ßos Realizados:</span>
                            <span class="font-bold" id="public-services">1500+</span>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-50 p-6 rounded-lg shadow-md">
                    <h3 class="text-xl font-bold mb-4">Tend√™ncias</h3>
                    <canvas id="publicTrendsChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact Section -->
    <section id="contact" class="py-16 bg-gray-100">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row">
                <div class="md:w-1/2 mb-10 md:mb-0 md:pr-10">
                    <h2 class="text-3xl font-bold mb-6">Entre em Contato</h2>
                    <div class="space-y-4">
                        <div class="flex items-start">
                            <i class="fas fa-map-marker-alt text-blue-500 text-xl mr-4 mt-1"></i>
                            <div>
                                <h3 class="font-semibold">Endere√ßo</h3>
                                <p class="text-gray-700">R. Floriano Miranda, 68 - S√£o Paulo/SP</p>
                            </div>
                        </div>
                        <div class="flex items-start">
                            <i class="fas fa-phone-alt text-blue-500 text-xl mr-4 mt-1"></i>
                            <div>
                                <h3 class="font-semibold">Telefone</h3>
                                <p class="text-gray-700">(11) 97723-8466</p>
                            </div>
                        </div>
                        <div class="flex items-start">
                            <i class="fas fa-envelope text-blue-500 text-xl mr-4 mt-1"></i>
                            <div>
                                <h3 class="font-semibold">Email</h3>
                                <p class="text-gray-700">contato@lbrothers.com.br</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="md:w-1/2">
                    <div class="bg-white p-8 rounded-lg shadow-md">
                        <h3 class="text-xl font-semibold mb-6">Envie uma mensagem</h3>
                        <div id="contact-messages"></div>
                        <form id="contact-form">
                            <div class="input-container">
                                <input type="text" id="contact-name" name="name" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder=" " required>
                                <label for="contact-name" class="floating-label">Seu Nome</label>
                            </div>
                            <div class="input-container">
                                <input type="email" id="contact-email" name="email" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder=" " required>
                                <label for="contact-email" class="floating-label">Seu Email</label>
                            </div>
                            <div class="input-container">
                                <textarea id="contact-message" name="message" rows="4" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder=" " required></textarea>
                                <label for="contact-message" class="floating-label">Sua Mensagem</label>
                            </div>
                            <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-3 px-6 rounded-lg transition">
                                <span class="loading spinner mr-2"></span>
                                Enviar Mensagem
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="gradient-bg text-white py-12">
        <div class="container mx-auto px-4">
            <div class="text-center">
                <div class="flex items-center justify-center space-x-2 mb-4">
                    <i class="fas fa-car-side text-2xl text-blue-400"></i>
                    <h3 class="text-xl font-bold">L' Brothers</h3>
                </div>
                <p class="text-gray-300 mb-4">Excel√™ncia em est√©tica automotiva desde 2020.</p>
                <div class="flex justify-center space-x-4">
                    <a href="https://www.instagram.com/lavarapidolbrothers" class="bg-pink-500 text-white w-10 h-10 rounded-full flex items-center justify-center hover:bg-pink-600 transition" target="_blank">
                        <i class="fab fa-instagram"></i>
                    </a>
                </div>
                <p class="text-gray-400 mt-4">¬© 2025 L' Brothers. Todos os direitos reservados.</p>
            </div>
        </div>
    </footer>

    <!-- Modals -->
    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md mx-4">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold">√Årea do Cliente</h3>
                    <button onclick="closeModal('loginModal')" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="flex border-b mb-6">
                    <button onclick="switchTab('loginTab')" class="tab-button px-4 py-2 font-medium border-b-2 border-blue-500 text-blue-500">Login</button>
                    <button onclick="switchTab('registerTab')" class="tab-button px-4 py-2 font-medium text-gray-500">Cadastro</button>
                </div>
                
                <div id="loginTab" class="tab-content active">
                    <div id="login-messages"></div>
                    <form id="login-form">
                        <div class="input-container">
                            <input type="email" id="login-email" name="email" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder=" " required>
                            <label for="login-email" class="floating-label">Email</label>
                        </div>
                        <div class="input-container">
                            <input type="password" id="login-password" name="password" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder=" " required>
                            <label for="login-password" class="floating-label">Senha</label>
                        </div>
                        <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-3 px-6 rounded-lg transition mb-4">
                            <span class="loading spinner mr-2"></span>
                            Entrar
                        </button>
                    </form>
                </div>
                
                <div id="registerTab" class="tab-content">
                    <div id="register-messages"></div>
                    <form id="register-form">
                        <div class="input-container">
                            <input type="text" id="register-name" name="name" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder=" " required>
                            <label for="register-name" class="floating-label">Nome Completo</label>
                        </div>
                        <div class="input-container">
                            <input type="email" id="register-email" name="email" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder=" " required>
                            <label for="register-email" class="floating-label">Email</label>
                        </div>
                        <div class="input-container">
                            <input type="tel" id="register-phone" name="phone" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder=" " required>
                            <label for="register-phone" class="floating-label">Telefone</label>
                        </div>
                        <div class="input-container">
                            <input type="password" id="register-password" name="password" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder=" " required>
                            <label for="register-password" class="floating-label">Senha</label>
                        </div>
                        <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-3 px-6 rounded-lg transition">
                            <span class="loading spinner mr-2"></span>
                            Cadastrar
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Login Modal -->
    <div id="adminLoginModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md mx-4">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold">Acesso Administrativo</h3>
                    <button onclick="closeModal('adminLoginModal')" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div id="admin-login-messages"></div>
                <form id="admin-login-form">
                    <div class="input-container">
                        <input type="text" id="admin-username" name="username" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder=" " required>
                        <label for="admin-username" class="floating-label">Usu√°rio</label>
                    </div>
                    <div class="input-container">
                        <input type="password" id="admin-password" name="password" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder=" " required>
                        <label for="admin-password" class="floating-label">Senha</label>
                    </div>
                    <button type="submit" class="w-full bg-purple-500 hover:bg-purple-600 text-white font-medium py-3 px-6 rounded-lg transition">
                        <span class="loading spinner mr-2"></span>
                        Entrar como Admin
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Schedule Modal -->
    <div id="scheduleModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold">Agendar Servi√ßo</h3>
                    <button onclick="closeModal('scheduleModal')" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div id="schedule-messages"></div>
                <form id="schedule-form">
                    <div class="input-container">
                        <select id="service-select" name="service" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            <option value="">Selecione um servi√ßo</option>
                            <option value="lavagem-premium">Lavagem Premium (R$ 120-250)</option>
                            <option value="polimento-cristalizado">Polimento Cristalizado (R$ 350-600)</option>
                            <option value="detalhamento-interno">Detalhamento Interno (R$ 250-400)</option>
                            <option value="protecao-pintura">Prote√ß√£o de Pintura (R$ 500-1200)</option>
                            <option value="higienizacao-ar">Higieniza√ß√£o AR (R$ 150-250)</option>
                        </select>
                    </div>
                    
                    <div class="input-container">
                        <input type="text" id="vehicle-info" name="vehicle" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder=" " required>
                        <label for="vehicle-info" class="floating-label">Ve√≠culo (Marca, Modelo, Ano)</label>
                    </div>
                    
                    <div class="input-container">
                        <input type="date" id="schedule-date" name="date" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                    </div>
                    
                    <div class="input-container">
                        <select id="schedule-time" name="time" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" required>
                            <option value="">Selecione hor√°rio</option>
                            <option value="08:00">08:00</option>
                            <option value="09:00">09:00</option>
                            <option value="10:00">10:00</option>
                            <option value="11:00">11:00</option>
                            <option value="13:00">13:00</option>
                            <option value="14:00">14:00</option>
                            <option value="15:00">15:00</option>
                            <option value="16:00">16:00</option>
                        </select>
                    </div>
                    
                    <div class="input-container">
                        <textarea id="schedule-notes" name="notes" rows="3" class="w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder=" "></textarea>
                        <label for="schedule-notes" class="floating-label">Observa√ß√µes (opcional)</label>
                    </div>
                    
                    <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-medium py-3 px-6 rounded-lg transition">
                        <span class="loading spinner mr-2"></span>
                        Confirmar Agendamento
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Services Modal -->
    <div id="servicesModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl mx-4 max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold">Nossos Servi√ßos</h3>
                    <button onclick="closeModal('servicesModal')" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="border rounded-lg p-6">
                        <h4 class="font-semibold text-lg mb-2">Lavagem Premium</h4>
                        <p class="text-blue-500 font-bold mb-2">R$ 120 - R$ 250</p>
                        <p class="text-gray-600 mb-4">Lavagem completa com produtos importados, limpeza de rodas, vidros e acabamento perfeito.</p>
                        <button onclick="scheduleService('lavagem-premium')" class="text-blue-500 hover:text-blue-700 font-medium">Agendar</button>
                    </div>
                    
                    <div class="border rounded-lg p-6">
                        <h4 class="font-semibold text-lg mb-2">Polimento Cristalizado</h4>
                        <p class="text-blue-500 font-bold mb-2">R$ 350 - R$ 600</p>
                        <p class="text-gray-600 mb-4">Remo√ß√£o de riscos, prote√ß√£o duradoura at√© 12 meses.</p>
                        <button onclick="scheduleService('polimento-cristalizado')" class="text-blue-500 hover:text-blue-700 font-medium">Agendar</button>
                    </div>
                    
                    <div class="border rounded-lg p-6">
                        <h4 class="font-semibold text-lg mb-2">Detalhamento Interno</h4>
                        <p class="text-blue-500 font-bold mb-2">R$ 250 - R$ 400</p>
                        <p class="text-gray-600 mb-4">Limpeza profunda, higieniza√ß√£o de estofados e componentes.</p>
                        <button onclick="scheduleService('detalhamento-interno')" class="text-blue-500 hover:text-blue-700 font-medium">Agendar</button>
                    </div>
                    
                    <div class="border rounded-lg p-6">
                        <h4 class="font-semibold text-lg mb-2">Prote√ß√£o de Pintura</h4>
                        <p class="text-blue-500 font-bold mb-2">R$ 500 - R$ 1.200</p>
                        <p class="text-gray-600 mb-4">Aplica√ß√£o de cer√¢mica para prote√ß√£o contra UV e contamina√ß√£o.</p>
                        <button onclick="scheduleService('protecao-pintura')" class="text-blue-500 hover:text-blue-700 font-medium">Agendar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md mx-4 p-8 text-center">
            <i class="fas fa-check-circle text-green-500 text-6xl mb-4"></i>
            <h3 class="text-2xl font-bold mb-2">Sucesso!</h3>
            <p id="success-message" class="text-gray-600 mb-6">Opera√ß√£o realizada com sucesso!</p>
            <button onclick="closeModal('successModal')" class="bg-blue-500 hover:bg-blue-600 text-white font-medium py-2 px-6 rounded-lg">OK</button>
        </div>
    </div>

    <script>
        // ========================================
        // CONFIGURA√á√ïES CORRIGIDAS
        // ========================================
        
        // EmailJS Configuration - CORRIGIDO
        const EMAILJS_CONFIG = {
            serviceID: 'service_gearthp',  // Corrigido conforme o print
            templateID: 'template_90i3c9g',
            publicKey: 'DSo5lZAqsTT5-m6xZ'
        };

        // Supabase Configuration - Mantido conforme original
        const SUPABASE_URL = 'https://ulyxmbzdwntddcesjsnw.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVseXhtYnpkd250ZGRjZXNqc253Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc4ODIyMzEsImV4cCI6MjA3MzQ1ODIzMX0.Q3OmlDne3ZoU1QJHOzr_MD6ho4FaRynGJoaz_9pZ3UM';
        
        let supabase = null;
        
        // Inicializa√ß√£o do Supabase
        try {
            supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            console.log('‚úÖ Supabase conectado com sucesso');
            
            // Teste de conex√£o
            testSupabaseConnection();
        } catch (error) {
            console.error('‚ùå Erro ao conectar Supabase:', error);
        }

        // Inicializa√ß√£o do EmailJS
        (function() {
            try {
                emailjs.init(EMAILJS_CONFIG.publicKey);
                console.log('‚úÖ EmailJS inicializado com sucesso');
                
                // Teste de configura√ß√£o
                testEmailJSConfiguration();
            } catch (error) {
                console.error('‚ùå Erro ao inicializar EmailJS:', error);
            }
        })();

        // ========================================
        // FUN√á√ïES DE TESTE
        // ========================================
        
        async function testSupabaseConnection() {
            try {
                const { data, error } = await supabase.from('users').select('count', { count: 'exact' });
                if (error) throw error;
                console.log('‚úÖ Teste Supabase bem-sucedido');
            } catch (error) {
                console.error('‚ùå Teste Supabase falhou:', error.message);
            }
        }

        function testEmailJSConfiguration() {
            if (typeof emailjs === 'undefined') {
                console.error('‚ùå EmailJS n√£o carregado');
                return;
            }
            console.log('‚úÖ EmailJS configurado corretamente');
        }

        // ========================================
        // DATABASE MANAGER CORRIGIDO
        // ========================================
        
        class DatabaseManager {
            constructor() {
                this.isSupabaseEnabled = !!supabase;
            }

            async store(table, data) {
                console.log(`üìù Tentando salvar em ${table}:`, data);
                
                if (this.isSupabaseEnabled) {
                    try {
                        // Adicionar timestamp se n√£o existir
                        const dataWithTimestamp = {
                            ...data,
                            created_at: new Date().toISOString()
                        };

                        const { data: result, error } = await supabase
                            .from(table)
                            .insert([dataWithTimestamp])
                            .select()
                            .single();
                        
                        if (error) {
                            console.error(`‚ùå Erro Supabase em ${table}:`, error);
                            throw error;
                        }
                        
                        console.log(`‚úÖ Salvo no Supabase ${table}:`, result);
                        return { success: true, data: result };
                    } catch (error) {
                        console.error(`‚ùå Erro ao salvar em ${table}:`, error);
                        return this.storeLocal(table, data);
                    }
                } else {
                    return this.storeLocal(table, data);
                }
            }

            async fetch(table, filters = {}) {
                console.log(`üìñ Buscando em ${table} com filtros:`, filters);
                
                if (this.isSupabaseEnabled) {
                    try {
                        let query = supabase.from(table).select('*');
                        
                        Object.entries(filters).forEach(([key, value]) => {
                            query = query.eq(key, value);
                        });
                        
                        const { data, error } = await query.order('created_at', { ascending: false });
                        if (error) throw error;
                        
                        console.log(`‚úÖ Dados obtidos do Supabase ${table}:`, data);
                        return { success: true, data };
                    } catch (error) {
                        console.error(`‚ùå Erro ao buscar ${table}:`, error);
                        return this.fetchLocal(table, filters);
                    }
                } else {
                    return this.fetchLocal(table, filters);
                }
            }

            async update(table, id, updates) {
                console.log(`üìù Atualizando ${table} ID ${id}:`, updates);
                
                if (this.isSupabaseEnabled) {
                    try {
                        const { data, error } = await supabase
                            .from(table)
                            .update({ ...updates, updated_at: new Date().toISOString() })
                            .eq('id', id)
                            .select()
                            .single();
                        
                        if (error) throw error;
                        console.log(`‚úÖ Atualizado no Supabase ${table}:`, data);
                        return { success: true, data };
                    } catch (error) {
                        console.error(`‚ùå Erro ao atualizar ${table}:`, error);
                        return this.updateLocal(table, id, updates);
                    }
                } else {
                    return this.updateLocal(table, id, updates);
                }
            }

            // M√©todos de fallback para localStorage
            storeLocal(table, data) {
                const items = JSON.parse(localStorage.getItem(`lbrothers_${table}`) || '[]');
                const newItem = { 
                    ...data, 
                    id: this.generateId(), 
                    created_at: new Date().toISOString() 
                };
                items.push(newItem);
                localStorage.setItem(`lbrothers_${table}`, JSON.stringify(items));
                console.log(`üíæ Salvo localmente em ${table}:`, newItem);
                return { success: true, data: newItem };
            }

            fetchLocal(table, filters = {}) {
                const items = JSON.parse(localStorage.getItem(`lbrothers_${table}`) || '[]');
                let filtered = items;
                
                Object.entries(filters).forEach(([key, value]) => {
                    filtered = filtered.filter(item => item[key] === value);
                });
                
                console.log(`üíæ Dados locais de ${table}:`, filtered);
                return { success: true, data: filtered };
            }

            updateLocal(table, id, updates) {
                const items = JSON.parse(localStorage.getItem(`lbrothers_${table}`) || '[]');
                const index = items.findIndex(item => item.id === id);
                
                if (index !== -1) {
                    items[index] = { ...items[index], ...updates, updated_at: new Date().toISOString() };
                    localStorage.setItem(`lbrothers_${table}`, JSON.stringify(items));
                    console.log(`üíæ Atualizado localmente em ${table}:`, items[index]);
                    return { success: true, data: items[index] };
                }
                
                return { success: false, error: 'Item n√£o encontrado' };
            }

            generateId() {
                return 'id_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
            }
        }

        const db = new DatabaseManager();

        // ========================================
        // EMAIL FUNCTIONS CORRIGIDAS
        // ========================================
        
        async function sendConfirmationEmail(appointmentData, userEmail) {
            console.log('üìß Tentando enviar email para:', userEmail);
            console.log('üìß Dados do agendamento:', appointmentData);
            
            try {
                const templateParams = {
                    user_name: appointmentData.user_name || 'Cliente',
                    to_email: userEmail,
                    service_name: getServiceName(appointmentData.service),
                    vehicle: appointmentData.vehicle,
                    appointment_date: formatDate(appointmentData.date),
                    appointment_time: appointmentData.time,
                    notes: appointmentData.notes || 'Nenhuma observa√ß√£o adicional'
                };

                console.log('üìß Par√¢metros do template:', templateParams);

                const result = await emailjs.send(
                    EMAILJS_CONFIG.serviceID,
                    EMAILJS_CONFIG.templateID,
                    templateParams,
                    EMAILJS_CONFIG.publicKey
                );

                console.log('‚úÖ Email enviado com sucesso:', result);
                return { success: true, result };
                
            } catch (error) {
                console.error('‚ùå Erro ao enviar email:', error);
                return { success: false, error: error.message || 'Erro desconhecido' };
            }
        }

        // ========================================
        // APPLICATION STATE
        // ========================================
        
        let appState = {
            currentUser: JSON.parse(localStorage.getItem('lbrothers_current_user') || 'null'),
            isAdmin: JSON.parse(localStorage.getItem('lbrothers_is_admin') || 'false'),
            appointments: [],
            analytics: {
                totalAppointments: 0,
                todayAppointments: 0,
                totalUsers: 0,
                totalContacts: 0
            }
        };

        // ========================================
        // UTILITY FUNCTIONS
        // ========================================
        
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR');
        }

        function getServiceName(serviceKey) {
            const services = {
                'lavagem-premium': 'Lavagem Premium',
                'polimento-cristalizado': 'Polimento Cristalizado',
                'detalhamento-interno': 'Detalhamento Interno',
                'protecao-pintura': 'Prote√ß√£o de Pintura',
                'higienizacao-ar': 'Higieniza√ß√£o AR'
            };
            return services[serviceKey] || serviceKey;
        }

        function showMessage(containerId, message, type = 'success') {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            const cssClass = type === 'success' ? 'success-message' : 'error-message';
            container.innerHTML = `<div class="${cssClass}">${message}</div>`;
            setTimeout(() => container.innerHTML = '', 5000);
        }

        function showLoading(buttonElement, show = true) {
            const spinner = buttonElement.querySelector('.loading');
            if (spinner) {
                spinner.classList.toggle('active', show);
            }
            buttonElement.disabled = show;
        }

        // ========================================
        // USER MANAGEMENT CORRIGIDO
        // ========================================
        
        async function registerUser(userData) {
            console.log('üë§ Registrando usu√°rio:', userData.email);
            
            try {
                // Verificar se o email j√° existe
                const existingUsers = await db.fetch('users', { email: userData.email });
                
                if (existingUsers.data.length > 0) {
                    console.log('‚ùå Email j√° cadastrado');
                    return { success: false, message: 'Email j√° cadastrado!' };
                }

                // Hash b√°sico da senha (use bcrypt em produ√ß√£o)
                const hashedPassword = btoa(userData.password);
                
                const newUser = {
                    name: userData.name,
                    email: userData.email,
                    phone: userData.phone,
                    password: hashedPassword,
                    role: 'user'
                };

                const result = await db.store('users', newUser);
                
                if (result.success) {
                    console.log('‚úÖ Usu√°rio registrado com sucesso');
                    return { success: true, message: 'Cadastro realizado com sucesso!' };
                }
                
                return { success: false, message: 'Erro ao criar conta. Tente novamente.' };
                
            } catch (error) {
                console.error('‚ùå Erro no registro:', error);
                return { success: false, message: 'Erro interno. Tente novamente.' };
            }
        }

        async function loginUser(email, password) {
            console.log('üîê Tentando login para:', email);
            
            try {
                const hashedPassword = btoa(password);
                const users = await db.fetch('users');
                
                const user = users.data.find(u => u.email === email && u.password === hashedPassword);
                
                if (user) {
                    appState.currentUser = {
                        id: user.id,
                        name: user.name,
                        email: user.email,
                        phone: user.phone,
                        role: user.role
                    };
                    
                    localStorage.setItem('lbrothers_current_user', JSON.stringify(appState.currentUser));
                    console.log('‚úÖ Login realizado com sucesso');
                    return { success: true, user: appState.currentUser };
                }
                
                console.log('‚ùå Credenciais inv√°lidas');
                return { success: false, message: 'Email ou senha incorretos!' };
                
            } catch (error) {
                console.error('‚ùå Erro no login:', error);
                return { success: false, message: 'Erro interno. Tente novamente.' };
            }
        }

        function logout() {
            appState.currentUser = null;
            appState.isAdmin = false;
            localStorage.removeItem('lbrothers_current_user');
            localStorage.removeItem('lbrothers_is_admin');
            updateUserInterface();
            
            const userDashboard = document.getElementById('userDashboard');
            if (userDashboard) userDashboard.classList.add('hidden');
            const adminPanel = document.getElementById('adminPanel');
            if (adminPanel) adminPanel.classList.remove('active');
            
            console.log('üëã Logout realizado');
        }

        function isLoggedIn() {
            return appState.currentUser !== null;
        }

        // ========================================
        // APPOINTMENT MANAGEMENT CORRIGIDO
        // ========================================
        
        async function createAppointment(appointmentData) {
            if (!isLoggedIn()) {
                return { success: false, message: 'Voc√™ precisa estar logado para agendar!' };
            }

            console.log('üìÖ Criando agendamento:', appointmentData);

            try {
                const appointment = {
                    user_id: appState.currentUser.id,
                    user_name: appState.currentUser.name,
                    user_email: appState.currentUser.email,
                    user_phone: appState.currentUser.phone,
                    service: appointmentData.service,
                    vehicle: appointmentData.vehicle,
                    date: appointmentData.date,
                    time: appointmentData.time,
                    notes: appointmentData.notes || '',
                    status: 'agendado'
                };

                const result = await db.store('appointments', appointment);
                
                if (result.success) {
                    console.log('‚úÖ Agendamento salvo, enviando email...');
                    
                    const emailResult = await sendConfirmationEmail(
                        result.data, 
                        appState.currentUser.email
                    );
                    
                    let successMessage = 'Agendamento confirmado com sucesso!';
                    if (emailResult.success) {
                        successMessage = 'Agendamento confirmado! Verifique seu email para detalhes.';
                        console.log('‚úÖ Email de confirma√ß√£o enviado');
                    } else {
                        console.warn('‚ö†Ô∏è Email n√£o enviado, mas agendamento foi salvo');
                        console.warn('Erro do email:', emailResult.error);
                    }
                    
                    await loadUserAppointments();
                    return { 
                        success: true, 
                        message: successMessage,
                        appointment: result.data 
                    };
                }
                
                return { success: false, message: 'Erro ao criar agendamento. Tente novamente.' };
                
            } catch (error) {
                console.error('‚ùå Erro ao criar agendamento:', error);
                return { success: false, message: 'Erro interno. Tente novamente.' };
            }
        }

        async function loadUserAppointments() {
            if (!isLoggedIn()) return;
            
            try {
                const result = await db.fetch('appointments', { user_id: appState.currentUser.id });
                appState.appointments = result.data || [];
                displayUserAppointments();
                console.log('üìÖ Agendamentos do usu√°rio carregados:', appState.appointments.length);
            } catch (error) {
                console.error('‚ùå Erro ao carregar agendamentos:', error);
            }
        }

        function displayUserAppointments() {
            const container = document.getElementById('user-appointments');
            if (!container) return;

            if (appState.appointments.length === 0) {
                container.innerHTML = '<p class="text-gray-500">Nenhum agendamento encontrado.</p>';
                return;
            }

            container.innerHTML = appState.appointments.map(apt => `
                <div class="bg-white rounded-lg shadow-md p-6">
                    <h3 class="font-semibold text-lg mb-2">${getServiceName(apt.service)}</h3>
                    <p class="text-gray-600 mb-2">Ve√≠culo: ${apt.vehicle}</p>
                    <p class="text-gray-600 mb-2">Data: ${formatDate(apt.date)}</p>
                    <p class="text-gray-600 mb-2">Hor√°rio: ${apt.time}</p>
                    <span class="status-badge status-${apt.status}">${apt.status}</span>
                    ${apt.notes ? `<p class="text-gray-500 text-sm mt-2">${apt.notes}</p>` : ''}
                </div>
            `).join('');
        }

        async function updateAppointmentStatus(appointmentId, newStatus) {
            try {
                const result = await db.update('appointments', appointmentId, { status: newStatus });
                
                if (result.success) {
                    console.log(`‚úÖ Status do agendamento ${appointmentId} atualizado para: ${newStatus}`);
                    await loadAdminData();
                    await loadUserAppointments();
                }
                
                return result;
            } catch (error) {
                console.error('‚ùå Erro ao atualizar status:', error);
                return { success: false, error };
            }
        }

        // ========================================
        // CONTACT MANAGEMENT
        // ========================================
        
        async function saveContact(contactData) {
            console.log('üì® Salvando contato:', contactData.email);
            
            try {
                const contact = {
                    name: contactData.name,
                    email: contactData.email,
                    phone: contactData.phone || '',
                    message: contactData.message
                };

                const result = await db.store('contacts', contact);
                
                if (result.success) {
                    console.log('‚úÖ Contato salvo com sucesso');
                    return { success: true, message: 'Mensagem enviada com sucesso!' };
                }
                
                return { success: false, message: 'Erro ao enviar mensagem. Tente novamente.' };
                
            } catch (error) {
                console.error('‚ùå Erro ao salvar contato:', error);
                return { success: false, message: 'Erro interno. Tente novamente.' };
            }
        }

        // ========================================
        // ADMIN FUNCTIONS
        // ========================================
        
        function checkAdminAccess(username, password) {
            if (username === 'ADMIN' && password === 'ADMIN') {
                appState.isAdmin = true;
                localStorage.setItem('lbrothers_is_admin', 'true');
                console.log('üîë Acesso admin autorizado');
                return true;
            }
            return false;
        }

        async function loadAdminData() {
            if (!appState.isAdmin) return;
            
            console.log('üë®‚Äçüíº Carregando dados administrativos...');
            
            try {
                const [appointmentsResult, usersResult, contactsResult] = await Promise.all([
                    db.fetch('appointments'),
                    db.fetch('users'),
                    db.fetch('contacts')
                ]);
                
                const appointments = appointmentsResult.data || [];
                const users = usersResult.data || [];
                const contacts = contactsResult.data || [];
                
                const today = new Date().toISOString().split('T')[0];
                appState.analytics = {
                    totalAppointments: appointments.length,
                    todayAppointments: appointments.filter(apt => apt.date === today).length,
                    totalUsers: users.filter(user => user.role !== 'admin').length,
                    totalContacts: contacts.length
                };
                
                updateAdminDashboard(appointments, contacts);
                updateAnalytics(appointments);
                
                console.log('‚úÖ Dados administrativos carregados:', appState.analytics);
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar dados admin:', error);
            }
        }

        function updateAdminDashboard(appointments, contacts) {
            const elements = {
                'total-appointments': appState.analytics.totalAppointments,
                'today-appointments': appState.analytics.todayAppointments,
                'total-users': appState.analytics.totalUsers,
                'total-contacts': appState.analytics.totalContacts
            };

            Object.entries(elements).forEach(([id, value]) => {
                const element = document.getElementById(id);
                if (element) element.textContent = value;
            });
            
            const appointmentsContainer = document.getElementById('admin-appointments');
            if (appointmentsContainer) {
                appointmentsContainer.innerHTML = `
                    <table class="w-full bg-white rounded-lg overflow-hidden">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-4 py-2 text-left">Cliente</th>
                                <th class="px-4 py-2 text-left">Servi√ßo</th>
                                <th class="px-4 py-2 text-left">Data</th>
                                <th class="px-4 py-2 text-left">Hor√°rio</th>
                                <th class="px-4 py-2 text-left">Status</th>
                                <th class="px-4 py-2 text-left">A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${appointments.map(apt => `
                                <tr class="border-b">
                                    <td class="px-4 py-2">${apt.user_name || 'N/A'}</td>
                                    <td class="px-4 py-2">${getServiceName(apt.service)}</td>
                                    <td class="px-4 py-2">${formatDate(apt.date)}</td>
                                    <td class="px-4 py-2">${apt.time}</td>
                                    <td class="px-4 py-2">
                                        <span class="status-badge status-${apt.status}">${apt.status}</span>
                                    </td>
                                    <td class="px-4 py-2">
                                        <select onchange="updateAppointmentStatus('${apt.id}', this.value)" class="border rounded px-2 py-1">
                                            <option value="agendado" ${apt.status === 'agendado' ? 'selected' : ''}>Agendado</option>
                                            <option value="confirmado" ${apt.status === 'confirmado' ? 'selected' : ''}>Confirmado</option>
                                            <option value="concluido" ${apt.status === 'concluido' ? 'selected' : ''}>Conclu√≠do</option>
                                            <option value="cancelado" ${apt.status === 'cancelado' ? 'selected' : ''}>Cancelado</option>
                                        </select>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            }
            
            const contactsContainer = document.getElementById('admin-contacts');
            if (contactsContainer) {
                contactsContainer.innerHTML = contacts.map(contact => `
                    <div class="border-b pb-4">
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="font-semibold">${contact.name}</h4>
                            <span class="text-sm text-gray-500">${formatDate(contact.created_at)}</span>
                        </div>
                        <p class="text-sm text-gray-600 mb-1">Email: ${contact.email}</p>
                        ${contact.phone ? `<p class="text-sm text-gray-600 mb-2">Telefone: ${contact.phone}</p>` : ''}
                        <p class="text-gray-700">${contact.message}</p>
                    </div>
                `).join('');
            }
        }

        function updateAnalytics(appointments) {
            updateServicesChart(appointments);
            updateMonthlyChart(appointments);
            updatePublicTrendsChart();
        }

        function updateServicesChart(appointments) {
            const ctx = document.getElementById('servicesChart');
            if (!ctx) return;

            const servicesCounts = {};
            appointments.forEach(apt => {
                const serviceName = getServiceName(apt.service);
                servicesCounts[serviceName] = (servicesCounts[serviceName] || 0) + 1;
            });

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(servicesCounts),
                    datasets: [{
                        data: Object.values(servicesCounts),
                        backgroundColor: [
                            '#3b82f6',
                            '#10b981',
                            '#f59e0b',
                            '#ef4444',
                            '#8b5cf6'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false
                }
            });
        }

        function updateMonthlyChart(appointments) {
            const ctx = document.getElementById('monthlyChart');
            if (!ctx) return;

            const monthlyCounts = {};
            appointments.forEach(apt => {
                const month = new Date(apt.created_at).toLocaleDateString('pt-BR', { month: 'short', year: '2-digit' });
                monthlyCounts[month] = (monthlyCounts[month] || 0) + 1;
            });

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Object.keys(monthlyCounts),
                    datasets: [{
                        label: 'Agendamentos',
                        data: Object.values(monthlyCounts),
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function updatePublicTrendsChart() {
            const ctx = document.getElementById('publicTrendsChart');
            if (!ctx) return;

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun'],
                    datasets: [{
                        label: 'Servi√ßos Realizados',
                        data: [45, 52, 38, 61, 49, 58],
                        backgroundColor: '#3b82f6',
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // ========================================
        // UI FUNCTIONS
        // ========================================
        
        function updateUserInterface() {
            const loggedOutMenu = document.getElementById('user-menu-logged-out');
            const loggedInMenu = document.getElementById('user-menu-logged-in');
            const userName = document.getElementById('user-name');

            if (isLoggedIn()) {
                if (loggedOutMenu) loggedOutMenu.style.display = 'none';
                if (loggedInMenu) loggedInMenu.classList.remove('hidden');
                if (userName) userName.textContent = appState.currentUser.name;
                loadUserAppointments();
            } else {
                if (loggedOutMenu) loggedOutMenu.style.display = 'flex';
                if (loggedInMenu) loggedInMenu.classList.add('hidden');
            }

            if (appState.isAdmin) {
                loadAdminData();
            }
        }

        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('hidden');
                document.body.style.overflow = 'auto';
            }
        }

        function switchTab(activeTabId) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('border-blue-500', 'text-blue-500');
                btn.classList.add('text-gray-500');
            });
            
            const activeTab = document.getElementById(activeTabId);
            if (activeTab) {
                activeTab.classList.add('active');
                const tabButton = document.querySelector(`[onclick="switchTab('${activeTabId}')"]`);
                if (tabButton) {
                    tabButton.classList.add('border-blue-500', 'text-blue-500');
                    tabButton.classList.remove('text-gray-500');
                }
            }
        }

        function toggleUserDashboard() {
            const dashboard = document.getElementById('userDashboard');
            if (dashboard) {
                dashboard.classList.toggle('hidden');
                if (!dashboard.classList.contains('hidden')) {
                    loadUserAppointments();
                }
            }
        }

        function toggleAdminPanel() {
            const panel = document.getElementById('adminPanel');
            if (panel) {
                panel.classList.toggle('active');
                if (panel.classList.contains('active')) {
                    loadAdminData();
                }
            }
        }

        function toggleMobileMenu() {
            // Mobile menu implementation
            console.log('Mobile menu toggle');
        }

        function scheduleService(serviceType) {
            if (!isLoggedIn()) {
                openModal('loginModal');
                return;
            }
            
            closeModal('servicesModal');
            openModal('scheduleModal');
            
            const serviceSelect = document.getElementById('service-select');
            if (serviceSelect) {
                serviceSelect.value = serviceType;
            }
        }

        async function refreshAppointments() {
            if (appState.isAdmin) {
                await loadAdminData();
            }
        }

        // ========================================
        // EVENT LISTENERS
        // ========================================
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Inicializando sistema L\' Brothers...');
            updateUserInterface();
            
            // Login form
            const loginForm = document.getElementById('login-form');
            if (loginForm) {
                loginForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const button = e.target.querySelector('button[type="submit"]');
                    showLoading(button);
                    
                    const formData = new FormData(e.target);
                    const result = await loginUser(formData.get('email'), formData.get('password'));
                    
                    showLoading(button, false);
                    
                    if (result.success) {
                        showMessage('login-messages', 'Login realizado com sucesso!');
                        setTimeout(() => {
                            closeModal('loginModal');
                            updateUserInterface();
                        }, 1500);
                    } else {
                        showMessage('login-messages', result.message, 'error');
                    }
                });
            }

            // Register form
            const registerForm = document.getElementById('register-form');
            if (registerForm) {
                registerForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const button = e.target.querySelector('button[type="submit"]');
                    showLoading(button);
                    
                    const formData = new FormData(e.target);
                    const userData = {
                        name: formData.get('name'),
                        email: formData.get('email'),
                        phone: formData.get('phone'),
                        password: formData.get('password')
                    };
                    
                    const result = await registerUser(userData);
                    
                    showLoading(button, false);
                    
                    if (result.success) {
                        showMessage('register-messages', result.message);
                        setTimeout(() => switchTab('loginTab'), 1500);
                    } else {
                        showMessage('register-messages', result.message, 'error');
                    }
                });
            }

            // Admin login form
            const adminLoginForm = document.getElementById('admin-login-form');
            if (adminLoginForm) {
                adminLoginForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    const formData = new FormData(e.target);
                    const username = formData.get('username');
                    const password = formData.get('password');
                    
                    if (checkAdminAccess(username, password)) {
                        showMessage('admin-login-messages', 'Acesso administrativo autorizado!');
                        setTimeout(() => {
                            closeModal('adminLoginModal');
                            toggleAdminPanel();
                        }, 1500);
                    } else {
                        showMessage('admin-login-messages', 'Credenciais inv√°lidas!', 'error');
                    }
                });
            }

            // Schedule form
            const scheduleForm = document.getElementById('schedule-form');
            if (scheduleForm) {
                scheduleForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const button = e.target.querySelector('button[type="submit"]');
                    showLoading(button);
                    
                    const formData = new FormData(e.target);
                    const appointmentData = {
                        service: formData.get('service'),
                        vehicle: formData.get('vehicle'),
                        date: formData.get('date'),
                        time: formData.get('time'),
                        notes: formData.get('notes')
                    };
                    
                    const result = await createAppointment(appointmentData);
                    
                    showLoading(button, false);
                    
                    if (result.success) {
                        document.getElementById('success-message').textContent = result.message;
                        closeModal('scheduleModal');
                        openModal('successModal');
                        scheduleForm.reset();
                    } else {
                        showMessage('schedule-messages', result.message, 'error');
                    }
                });
            }

            // Contact form
            const contactForm = document.getElementById('contact-form');
            if (contactForm) {
                contactForm.addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const button = e.target.querySelector('button[type="submit"]');
                    showLoading(button);
                    
                    const formData = new FormData(e.target);
                    const contactData = {
                        name: formData.get('name'),
                        email: formData.get('email'),
                        message: formData.get('message')
                    };
                    
                    const result = await saveContact(contactData);
                    
                    showLoading(button, false);
                    
                    if (result.success) {
                        showMessage('contact-messages', result.message);
                        contactForm.reset();
                    } else {
                        showMessage('contact-messages', result.message, 'error');
                    }
                });
            }

            // Set minimum date for appointment scheduling
            const scheduleDate = document.getElementById('schedule-date');
            if (scheduleDate) {
                const today = new Date().toISOString().split('T')[0];
                scheduleDate.min = today;
            }

            console.log('‚úÖ Sistema L\' Brothers inicializado com sucesso!');
        });

        // ========================================
        // SISTEMA DE TESTES GLOBAL
        // ========================================
        
        window.lbrothersSystem = {
            // Teste de EmailJS
            testEmailJS: async function() {
                const testData = {
                    user_name: 'Cliente Teste',
                    service: 'lavagem-premium',
                    vehicle: 'Honda Civic 2020',
                    date: '2025-01-20',
                    time: '14:00',
                    notes: 'Teste do sistema EmailJS'
                };
                
                console.log('üß™ Testando EmailJS...');
                const result = await sendConfirmationEmail(testData, 'teste@example.com');
                console.log('Resultado do teste EmailJS:', result);
                return result;
            },
            
            // Teste de Supabase
            testSupabase: async function() {
                console.log('üß™ Testando Supabase...');
                const testUser = {
                    name: 'Usu√°rio Teste',
                    email: 'teste@supabase.com',
                    phone: '11999999999',
                    password: btoa('senha123'),
                    role: 'user'
                };
                
                const result = await db.store('users', testUser);
                console.log('Resultado do teste Supabase:', result);
                return result;
            },
            
            // Status do sistema
            getSystemStatus: function() {
                const status = {
                    supabaseConnected: !!supabase,
                    emailJSConfigured: !!EMAILJS_CONFIG.serviceID,
                    userLoggedIn: isLoggedIn(),
                    isAdmin: appState.isAdmin,
                    appointmentsCount: appState.appointments.length,
                    config: {
                        supabaseUrl: SUPABASE_URL,
                        emailJSServiceId: EMAILJS_CONFIG.serviceID,
                        emailJSTemplateId: EMAILJS_CONFIG.templateID
                    }
                };
                console.log('üìä Status do sistema:', status);
                return status;
            },
            
            // Limpar dados de teste
            clearTestData: function() {
                localStorage.removeItem('lbrothers_users');
                localStorage.removeItem('lbrothers_appointments');
                localStorage.removeItem('lbrothers_contacts');
                console.log('üßπ Dados de teste limpos');
            },
            
            // Acessar dados diretamente
            db: db,
            appState: appState,
            
            // Fun√ß√µes de debug
            debug: {
                emailConfig: EMAILJS_CONFIG,
                supabaseUrl: SUPABASE_URL,
                isSupabaseConnected: !!supabase
            }
        };

        console.log('üéâ Sistema L\' Brothers carregado com sucesso!');
        console.log('üìû Use window.lbrothersSystem para acessar funcionalidades de teste');
        console.log('üîç Status:', window.lbrothersSystem.getSystemStatus());
    </script>
</body>
</html>
