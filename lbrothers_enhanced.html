
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L' Brothers - Est√©tica Automotiva Premium</title>
    <meta name="description" content="Est√©tica automotiva premium em S√£o Paulo. Agendamento online, lavagem, polimento e detalhamento profissional.">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }
        .service-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        /* FIX: Floating labels apenas para telas maiores */
        @media (min-width: 768px) {
            .floating-label-input:focus ~ .floating-label,
            .floating-label-input:not(:placeholder-shown) ~ .floating-label {
                transform: translateY(-120%);
                font-size: 0.75rem;
                color: #A0AEC0;
            }
            .floating-label-input:not(:placeholder-shown) {
                padding-top: 1.5rem;
            }
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 font-sans leading-normal tracking-normal gradient-bg">

    <nav class="bg-gray-800 p-4 fixed w-full z-10 top-0">
        <div class="container mx-auto flex items-center justify-between flex-wrap">
            <div class="flex items-center flex-shrink-0 text-white mr-6">
                <span class="font-semibold text-2xl tracking-tight">L' Brothers</span>
            </div>
            <div class="block lg:hidden">
                <button class="flex items-center px-3 py-2 border rounded text-gray-200 border-gray-400 hover:text-white hover:border-white" id="nav-toggle">
                    <svg class="fill-current h-3 w-3" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><title>Menu</title><path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z"/></svg>
                </button>
            </div>
            <div class="w-full flex-grow lg:flex lg:items-center lg:w-auto hidden pt-6 lg:pt-0" id="nav-content">
                <div class="text-sm lg:flex-grow">
                    <a href="#inicio" class="block mt-4 lg:inline-block lg:mt-0 text-gray-200 hover:text-white mr-4">
                        In√≠cio
                    </a>
                    <a href="#servicos" class="block mt-4 lg:inline-block lg:mt-0 text-gray-200 hover:text-white mr-4">
                        Servi√ßos
                    </a>
                    <a href="#depoimentos" class="block mt-4 lg:inline-block lg:mt-0 text-gray-200 hover:text-white mr-4">
                        Depoimentos
                    </a>
                    <a href="#contato" class="block mt-4 lg:inline-block lg:mt-0 text-gray-200 hover:text-white">
                        Contato
                    </a>
                </div>
                <div>
                    <button id="cta-button" class="inline-block text-sm px-4 py-2 leading-none border rounded text-white border-white hover:border-transparent hover:text-gray-900 hover:bg-white mt-4 lg:mt-0">√Årea do Cliente</button>
                </div>
            </div>
        </div>
    </nav>

    <header id="inicio" class="pt-24 md:pt-36 pb-12 flex flex-col justify-center items-center text-center px-4">
        <h1 class="text-4xl md:text-5xl font-bold leading-tight">Est√©tica Automotiva Premium</h1>
        <p class="mt-4 text-xl md:text-2xl text-gray-400">Transforme seu carro em uma obra de arte. Detalhamento e prote√ß√£o de alto n√≠vel.</p>
        <div class="mt-8">
            <a href="#agendamento" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transition duration-300">Agende seu Hor√°rio</a>
        </div>
    </header>

    <section id="servicos" class="py-12 md:py-24 container mx-auto px-4">
        <h2 class="text-3xl md:text-4xl font-bold text-center mb-12">Nossos Servi√ßos</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            <div class="service-card p-6 bg-gray-800 rounded-lg shadow-xl text-center transition-all duration-300">
                <i class="fas fa-car-wash text-5xl text-blue-400 mb-4"></i>
                <h3 class="font-bold text-xl mb-2">Lavagem Detalhada Premium</h3>
                <p class="text-gray-400 text-sm">Limpeza completa e minuciosa, com produtos de pH neutro e t√©cnicas que preservam a pintura.</p>
            </div>
            <div class="service-card p-6 bg-gray-800 rounded-lg shadow-xl text-center transition-all duration-300">
                <i class="fas fa-sparkles text-5xl text-yellow-400 mb-4"></i>
                <h3 class="font-bold text-xl mb-2">Polimento T√©cnico</h3>
                <p class="text-gray-400 text-sm">Remo√ß√£o de riscos e imperfei√ß√µes, devolvendo o brilho e a profundidade da pintura original.</p>
            </div>
            <div class="service-card p-6 bg-gray-800 rounded-lg shadow-xl text-center transition-all duration-300">
                <i class="fas fa-shield-alt text-5xl text-red-400 mb-4"></i>
                <h3 class="font-bold text-xl mb-2">Prote√ß√£o Cer√¢mica</h3>
                <p class="text-gray-400 text-sm">Aplica√ß√£o de revestimento cer√¢mico para prote√ß√£o duradoura contra intemp√©ries e arranh√µes.</p>
            </div>
            <div class="service-card p-6 bg-gray-800 rounded-lg shadow-xl text-center transition-all duration-300">
                <i class="fas fa-couch text-5xl text-purple-400 mb-4"></i>
                <h3 class="font-bold text-xl mb-2">Higieniza√ß√£o Interna</h3>
                <p class="text-gray-400 text-sm">Limpeza profunda e esteriliza√ß√£o de estofados, carpetes e painel, eliminando odores e bact√©rias.</p>
            </div>
            <div class="service-card p-6 bg-gray-800 rounded-lg shadow-xl text-center transition-all duration-300">
                <i class="fas fa-glass-whiskey text-5xl text-gray-400 mb-4"></i>
                <h3 class="font-bold text-xl mb-2">Vitrifica√ß√£o de Vidros</h3>
                <p class="text-gray-400 text-sm">Melhora a visibilidade na chuva e protege os vidros contra manchas e contamina√ß√µes.</p>
            </div>
            <div class="service-card p-6 bg-gray-800 rounded-lg shadow-xl text-center transition-all duration-300">
                <i class="fas fa-engine text-5xl text-orange-400 mb-4"></i>
                <h3 class="font-bold text-xl mb-2">Detalhamento de Motor</h3>
                <p class="text-gray-400 text-sm">Limpeza e prote√ß√£o seguras para o motor, sem danificar componentes el√©tricos ou mec√¢nicos.</p>
            </div>
        </div>
    </section>

    <section id="depoimentos" class="py-12 md:py-24 bg-gray-800">
        <div class="container mx-auto px-4">
            <h2 class="text-3xl md:text-4xl font-bold text-center mb-12">O que nossos clientes dizem</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <div class="bg-gray-700 p-6 rounded-lg shadow-xl">
                    <p class="text-lg italic text-gray-300 mb-4">"O trabalho foi impec√°vel! Meu carro parece novo de f√°brica. Recomendo a todos!"</p>
                    <div class="flex items-center">
                        <img class="w-12 h-12 rounded-full mr-4" src="https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?ixlib=rb-1.2.1&auto=format&fit=crop&w=128&h=128&q=80" alt="Foto de cliente">
                        <div class="text-sm">
                            <p class="text-white font-bold">Jo√£o Silva</p>
                            <p class="text-gray-400">Cliente Satisfeito</p>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-700 p-6 rounded-lg shadow-xl">
                    <p class="text-lg italic text-gray-300 mb-4">"A higieniza√ß√£o interna superou minhas expectativas. O cheiro de carro novo est√° de volta!"</p>
                    <div class="flex items-center">
                        <img class="w-12 h-12 rounded-full mr-4" src="https://images.unsplash.com/photo-1544005313-94ddf0286df2?ixlib=rb-1.2.1&auto=format&fit=crop&w=128&h=128&q=80" alt="Foto de cliente">
                        <div class="text-sm">
                            <p class="text-white font-bold">Maria Fernanda</p>
                            <p class="text-gray-400">Propriet√°ria de Sedan</p>
                        </div>
                    </div>
                </div>
                <div class="bg-gray-700 p-6 rounded-lg shadow-xl">
                    <p class="text-lg italic text-gray-300 mb-4">"O polimento removeu todos os riscos. Agora o carro brilha como um espelho. Atendimento excelente!"</p>
                    <div class="flex items-center">
                        <img class="w-12 h-12 rounded-full mr-4" src="https://images.unsplash.com/photo-1507003211169-0a0ed7246f2d?ixlib=rb-1.2.1&auto=format&fit=crop&w=128&h=128&q=80" alt="Foto de cliente">
                        <div class="text-sm">
                            <p class="text-white font-bold">Pedro Henrique</p>
                            <p class="text-gray-400">Amante de Carros</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="contato" class="py-12 md:py-24 container mx-auto px-4">
        <h2 class="text-3xl md:text-4xl font-bold text-center mb-12">Entre em Contato</h2>
        <div class="max-w-xl mx-auto bg-gray-800 p-8 rounded-lg shadow-xl">
            <p id="contact-message" class="text-center text-green-400 mb-4 hidden"></p>
            <form id="contact-form" class="space-y-6">
                <div class="relative">
                    <input type="text" id="contact_name" name="user_name" placeholder=" " required class="floating-label-input w-full px-4 py-3 bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600">
                    <label for="contact_name" class="floating-label absolute left-4 top-4 text-gray-400 transition-all duration-200 ease-in-out pointer-events-none">Seu Nome</label>
                </div>
                <div class="relative">
                    <input type="email" id="contact_email" name="user_email" placeholder=" " required class="floating-label-input w-full px-4 py-3 bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600">
                    <label for="contact_email" class="floating-label absolute left-4 top-4 text-gray-400 transition-all duration-200 ease-in-out pointer-events-none">Seu E-mail</label>
                </div>
                <div class="relative">
                    <textarea id="contact_message_area" name="message" placeholder=" " required rows="4" class="floating-label-input w-full px-4 py-3 bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600"></textarea>
                    <label for="contact_message_area" class="floating-label absolute left-4 top-4 text-gray-400 transition-all duration-200 ease-in-out pointer-events-none">Sua Mensagem</label>
                </div>
                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-md shadow-lg transition duration-300">Enviar Mensagem</button>
            </form>
        </div>
    </section>

    <footer class="bg-gray-900 text-center py-6 text-gray-500 text-sm">
        <p>¬© 2024 L' Brothers. Todos os direitos reservados.</p>
    </footer>

    <div id="modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50 hidden">
        <div class="bg-gray-800 rounded-lg p-6 w-full max-w-lg relative shadow-xl">
            <button id="modal-close" class="absolute top-4 right-4 text-gray-400 hover:text-white">&times;</button>
            
            <div id="modal-content">
                <div class="flex justify-around mb-6">
                    <button id="tab-login" class="tab-button px-4 py-2 border-b-2 border-blue-500 text-blue-500 font-semibold">Login</button>
                    <button id="tab-register" class="tab-button px-4 py-2 border-b-2 border-transparent text-gray-400 font-semibold">Cadastro</button>
                    <button id="tab-appointments" class="tab-button px-4 py-2 border-b-2 border-transparent text-gray-400 font-semibold hidden">Meus Agendamentos</button>
                    <button id="tab-admin" class="tab-button px-4 py-2 border-b-2 border-transparent text-gray-400 font-semibold hidden">Admin</button>
                </div>
                
                <div id="login-tab" class="space-y-6">
                    <form id="login-form">
                        <p id="login-message" class="text-center text-red-400 mb-4 hidden"></p>
                        <div class="relative mb-6">
                            <input type="email" id="login_email" placeholder=" " required class="floating-label-input w-full px-4 py-3 bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600">
                            <label for="login_email" class="floating-label absolute left-4 top-4 text-gray-400 transition-all duration-200 ease-in-out pointer-events-none">E-mail</label>
                        </div>
                        <div class="relative mb-6">
                            <input type="password" id="login_password" placeholder=" " required class="floating-label-input w-full px-4 py-3 bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600">
                            <label for="login_password" class="floating-label absolute left-4 top-4 text-gray-400 transition-all duration-200 ease-in-out pointer-events-none">Senha</label>
                        </div>
                        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-md shadow-lg transition duration-300">Login</button>
                    </form>
                </div>

                <div id="register-tab" class="hidden space-y-6">
                    <form id="register-form">
                        <p id="register-message" class="text-center text-red-400 mb-4 hidden"></p>
                        <div class="relative mb-6">
                            <input type="text" id="register_name" placeholder=" " required class="floating-label-input w-full px-4 py-3 bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600">
                            <label for="register_name" class="floating-label absolute left-4 top-4 text-gray-400 transition-all duration-200 ease-in-out pointer-events-none">Nome</label>
                        </div>
                        <div class="relative mb-6">
                            <input type="email" id="register_email" placeholder=" " required class="floating-label-input w-full px-4 py-3 bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600">
                            <label for="register_email" class="floating-label absolute left-4 top-4 text-gray-400 transition-all duration-200 ease-in-out pointer-events-none">E-mail</label>
                        </div>
                        <div class="relative mb-6">
                            <input type="tel" id="register_phone" placeholder=" " required class="floating-label-input w-full px-4 py-3 bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600">
                            <label for="register_phone" class="floating-label absolute left-4 top-4 text-gray-400 transition-all duration-200 ease-in-out pointer-events-none">Telefone</label>
                        </div>
                        <div class="relative mb-6">
                            <input type="password" id="register_password" placeholder=" " required class="floating-label-input w-full px-4 py-3 bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600">
                            <label for="register_password" class="floating-label absolute left-4 top-4 text-gray-400 transition-all duration-200 ease-in-out pointer-events-none">Senha</label>
                        </div>
                        <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-md shadow-lg transition duration-300">Cadastrar</button>
                    </form>
                </div>
                
                <div id="appointments-tab" class="hidden space-y-6">
                    <div id="appointments-list-container">
                        <h3 class="text-xl font-bold mb-4">Meus Agendamentos</h3>
                        <p id="no-appointments-message" class="text-gray-400">Nenhum agendamento encontrado.</p>
                        <div id="appointments-list" class="space-y-4"></div>
                        <button id="schedule-new-button" class="w-full mt-6 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-md shadow-lg transition duration-300">Agendar Novo Servi√ßo</button>
                    </div>

                    <div id="schedule-form-container" class="hidden">
                        <h3 class="text-xl font-bold mb-4">Agendar Servi√ßo</h3>
                        <form id="schedule-form" class="space-y-6">
                            <p id="schedule-message" class="text-center text-green-400 mb-4 hidden"></p>
                            <div class="relative">
                                <select id="service-select" name="service" required class="w-full px-4 py-3 bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600">
                                    <option value="" disabled selected>Selecione um Servi√ßo</option>
                                    <option value="Lavagem Detalhada Premium">Lavagem Detalhada Premium</option>
                                    <option value="Polimento T√©cnico">Polimento T√©cnico</option>
                                    <option value="Prote√ß√£o Cer√¢mica">Prote√ß√£o Cer√¢mica</option>
                                    <option value="Higieniza√ß√£o Interna">Higieniza√ß√£o Interna</option>
                                    <option value="Vitrifica√ß√£o de Vidros">Vitrifica√ß√£o de Vidros</option>
                                    <option value="Detalhamento de Motor">Detalhamento de Motor</option>
                                </select>
                            </div>
                            <div class="relative">
                                <input type="text" id="vehicle" name="vehicle" placeholder=" " required class="floating-label-input w-full px-4 py-3 bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600">
                                <label for="vehicle" class="floating-label absolute left-4 top-4 text-gray-400 transition-all duration-200 ease-in-out pointer-events-none">Ve√≠culo (Marca e Modelo)</label>
                            </div>
                            <div class="relative">
                                <input type="date" id="date" name="date" required class="floating-label-input w-full px-4 py-3 bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600">
                                <label for="date" class="floating-label absolute left-4 top-4 text-gray-400 transition-all duration-200 ease-in-out pointer-events-none">Data</label>
                            </div>
                            <div class="relative">
                                <input type="time" id="time" name="time" required class="floating-label-input w-full px-4 py-3 bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600">
                                <label for="time" class="floating-label absolute left-4 top-4 text-gray-400 transition-all duration-200 ease-in-out pointer-events-none">Hor√°rio</label>
                            </div>
                            <div class="relative">
                                <textarea id="notes" name="notes" placeholder=" " rows="3" class="floating-label-input w-full px-4 py-3 bg-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-600"></textarea>
                                <label for="notes" class="floating-label absolute left-4 top-4 text-gray-400 transition-all duration-200 ease-in-out pointer-events-none">Observa√ß√µes (opcional)</label>
                            </div>
                            <button type="submit" id="confirm-schedule-button" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-md shadow-lg transition duration-300">Confirmar Agendamento</button>
                            <button type="button" id="cancel-schedule-button" class="w-full mt-4 text-gray-400 hover:text-white">Cancelar</button>
                        </form>
                    </div>
                </div>
                
                <div id="admin-tab" class="hidden space-y-6">
                    <h3 class="text-xl font-bold mb-4">Painel do Administrador</h3>
                    <p class="text-gray-400">Vis√£o geral dos agendamentos e clientes.</p>
                    <div class="bg-gray-700 p-4 rounded-md shadow-md">
                        <h4 class="font-semibold mb-2">Total de Agendamentos por Servi√ßo</h4>
                        <canvas id="appointmentsChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const SUPABASE_URL = 'https://ulyxmbzdwntddcesjsnw.supabase.co';
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVseXhtYnpkd250ZGRjZXNqc253Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTY4MzQxNDUsImV4cCI6MTczMjYxMDE0NX0.Vw9iS0e4k_i2jU2p18n8kQd5x9l64z9G3cM7hV7B8lA';
            const EMAILJS_CONFIG = {
                serviceID: 'lbrothers_contato',
                templateID_contact: 'template_r1s42z8',
                templateID_appointment: 'template_0950qf5',
                publicKey: 'f3v32TjK8i_fEw3x-'
            };

            const lbrothersSystem = (function() {
                let supabaseClient = null;
                let isSupabaseEnabled = false;

                try {
                    supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                    isSupabaseEnabled = true;
                    console.log('‚úÖ Conex√£o Supabase OK.');
                } catch (error) {
                    isSupabaseEnabled = false;
                    console.error('‚ùå Falha na conex√£o Supabase:', error);
                }

                if (EMAILJS_CONFIG.serviceID && EMAILJS_CONFIG.publicKey) {
                    emailjs.init(EMAILJS_CONFIG.publicKey);
                    console.log('‚úÖ EmailJS inicializado com sucesso.');
                } else {
                    console.error('‚ùå EmailJS n√£o est√° configurado.');
                }

                // Estado da aplica√ß√£o
                let appState = {
                    user: null,
                    isLoggedIn: false,
                    isAdmin: false,
                    appointments: []
                };

                // Manipula√ß√£o do banco de dados (Supabase ou LocalStorage)
                const db = {
                    store: async function(table, data) {
                        if (isSupabaseEnabled) {
                            const { data: result, error } = await supabaseClient
                                .from(table)
                                .insert([data])
                                .select();
                            if (error) {
                                console.error(`‚ùå Erro ao salvar em ${table}:`, error.message);
                                return { success: false, error: error.message };
                            }
                            console.log(`‚úÖ Salvo no Supabase ${table}:`, result);
                            return { success: true, data: result[0] };
                        } else {
                            // LocalStorage fallback
                            let items = JSON.parse(localStorage.getItem(`lbrothers_${table}`)) || [];
                            const newItem = { id: Date.now(), ...data };
                            items.push(newItem);
                            localStorage.setItem(`lbrothers_${table}`, JSON.stringify(items));
                            console.log(`‚ö†Ô∏è Salvo localmente em ${table}:`, newItem);
                            return { success: true, data: newItem };
                        }
                    },

                    fetch: async function(table, filters = {}) {
                        if (isSupabaseEnabled) {
                            let query = supabaseClient.from(table).select('*');
                            if (filters.email) {
                                query = query.eq('email', filters.email);
                            }
                            if (filters.userId) {
                                query = query.eq('user_id', filters.userId);
                            }
                            const { data, error } = await query;
                            if (error) {
                                console.error(`‚ùå Erro ao buscar em ${table}:`, error.message);
                                return { success: false, error: error.message };
                            }
                            console.log(`‚úÖ Buscado do Supabase ${table}:`, data);
                            return { success: true, data: data };
                        } else {
                            // LocalStorage fallback
                            const items = JSON.parse(localStorage.getItem(`lbrothers_${table}`)) || [];
                            console.log(`‚ö†Ô∏è Buscado localmente de ${table}:`, items);
                            return { success: true, data: items };
                        }
                    }
                };

                // Fun√ß√µes de envio de e-mail
                const mail = {
                    sendContact: async function(formData) {
                        if (EMAILJS_CONFIG.publicKey) {
                            try {
                                const response = await emailjs.sendForm(
                                    EMAILJS_CONFIG.serviceID,
                                    EMAILJS_CONFIG.templateID_contact,
                                    formData
                                );
                                console.log('‚úÖ Email de contato enviado:', response);
                                return { success: true };
                            } catch (error) {
                                console.error('‚ùå Erro ao enviar email de contato:', error);
                                return { success: false, error: error };
                            }
                        } else {
                            console.warn('‚ö†Ô∏è EmailJS n√£o configurado. Email de contato n√£o ser√° enviado.');
                            return { success: false, error: 'EmailJS n√£o configurado' };
                        }
                    },
                    sendAppointment: async function(formData) {
                        if (EMAILJS_CONFIG.publicKey) {
                            try {
                                const response = await emailjs.sendForm(
                                    EMAILJS_CONFIG.serviceID,
                                    EMAILJS_CONFIG.templateID_appointment,
                                    formData
                                );
                                console.log('‚úÖ Email de agendamento enviado:', response);
                                return { success: true };
                            } catch (error) {
                                console.error('‚ùå Erro ao enviar email de agendamento:', error);
                                return { success: false, error: error };
                            }
                        } else {
                            console.warn('‚ö†Ô∏è EmailJS n√£o configurado. Email de agendamento n√£o ser√° enviado.');
                            return { success: false, error: 'EmailJS n√£o configurado' };
                        }
                    }
                };

                // L√≥gica da UI
                const ui = {
                    showModal: function() { document.getElementById('modal').classList.remove('hidden'); },
                    hideModal: function() { document.getElementById('modal').classList.add('hidden'); },
                    showTab: function(tabId) {
                        document.querySelectorAll('#modal-content > div:not(.flex)').forEach(el => el.classList.add('hidden'));
                        document.getElementById(tabId).classList.remove('hidden');
                        document.querySelectorAll('.tab-button').forEach(el => el.classList.remove('border-blue-500', 'text-blue-500'));
                        document.querySelectorAll('.tab-button').forEach(el => el.classList.add('border-transparent', 'text-gray-400'));
                        document.getElementById(`tab-${tabId.replace('-tab', '')}`).classList.remove('border-transparent', 'text-gray-400');
                        document.getElementById(`tab-${tabId.replace('-tab', '')}`).classList.add('border-blue-500', 'text-blue-500');
                    },
                    showMessage: function(elementId, message, type = 'success') {
                        const el = document.getElementById(elementId);
                        el.textContent = message;
                        el.classList.remove('hidden', 'text-green-400', 'text-red-400');
                        el.classList.add(type === 'success' ? 'text-green-400' : 'text-red-400');
                        setTimeout(() => el.classList.add('hidden'), 5000);
                    },
                    updateAppointmentsList: function(appointments) {
                        const listContainer = document.getElementById('appointments-list');
                        const noAppointments = document.getElementById('no-appointments-message');
                        listContainer.innerHTML = '';
                        if (appointments.length > 0) {
                            noAppointments.classList.add('hidden');
                            appointments.forEach(app => {
                                const appElement = document.createElement('div');
                                appElement.className = 'bg-gray-700 p-4 rounded-md shadow-md';
                                appElement.innerHTML = `
                                    <p class="font-semibold text-lg">${app.service}</p>
                                    <p class="text-gray-400">Ve√≠culo: ${app.vehicle}</p>
                                    <p class="text-gray-400">Data: ${app.date}</p>
                                    <p class="text-gray-400">Hora: ${app.time}</p>
                                `;
                                listContainer.appendChild(appElement);
                            });
                        } else {
                            noAppointments.classList.remove('hidden');
                        }
                    },
                    initAdminChart: function(appointments) {
                        const ctx = document.getElementById('appointmentsChart').getContext('2d');
                        const serviceCounts = {};
                        appointments.forEach(app => {
                            serviceCounts[app.service] = (serviceCounts[app.service] || 0) + 1;
                        });
                        const labels = Object.keys(serviceCounts);
                        const data = Object.values(serviceCounts);
                        new Chart(ctx, {
                            type: 'bar',
                            data: {
                                labels: labels,
                                datasets: [{
                                    label: 'Total de Agendamentos',
                                    data: data,
                                    backgroundColor: 'rgba(59, 130, 246, 0.5)',
                                    borderColor: 'rgba(59, 130, 246, 1)',
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                scales: {
                                    y: {
                                        beginAtZero: true
                                    }
                                }
                            }
                        });
                    }
                };

                // Event Listeners
                document.getElementById('nav-toggle').addEventListener('click', () => {
                    const navContent = document.getElementById('nav-content');
                    navContent.classList.toggle('hidden');
                });

                document.getElementById('cta-button').addEventListener('click', () => {
                    if (appState.isLoggedIn) {
                        if (appState.isAdmin) {
                            ui.showTab('admin-tab');
                        } else {
                            ui.showTab('appointments-tab');
                            ui.updateAppointmentsList(appState.appointments);
                        }
                    } else {
                        ui.showTab('login-tab');
                    }
                    ui.showModal();
                });

                document.getElementById('modal-close').addEventListener('click', ui.hideModal);
                document.getElementById('tab-login').addEventListener('click', () => ui.showTab('login-tab'));
                document.getElementById('tab-register').addEventListener('click', () => ui.showTab('register-tab'));
                document.getElementById('tab-appointments').addEventListener('click', () => ui.showTab('appointments-tab'));
                document.getElementById('tab-admin').addEventListener('click', () => ui.showTab('admin-tab'));
                
                document.getElementById('schedule-new-button').addEventListener('click', () => {
                    document.getElementById('appointments-list-container').classList.add('hidden');
                    document.getElementById('schedule-form-container').classList.remove('hidden');
                });

                document.getElementById('cancel-schedule-button').addEventListener('click', () => {
                    document.getElementById('appointments-list-container').classList.remove('hidden');
                    document.getElementById('schedule-form-container').classList.add('hidden');
                });
                
                // Forms
                document.getElementById('login-form').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const email = document.getElementById('login_email').value;
                    const password = document.getElementById('login_password').value;

                    const { data, success } = await db.fetch('users', { email: email });
                    if (success && data.length > 0) {
                        const user = data[0];
                        if (user.password === btoa(password)) { // Senha codificada em base64
                            appState.user = user;
                            appState.isLoggedIn = true;
                            appState.isAdmin = (user.role === 'admin');
                            
                            document.getElementById('cta-button').textContent = '√Årea do Cliente'; // Restaura o bot√£o

                            if(appState.isAdmin) {
                                document.getElementById('tab-appointments').classList.add('hidden');
                                document.getElementById('tab-admin').classList.remove('hidden');
                                ui.showTab('admin-tab');
                                const { data: allAppointments } = await db.fetch('appointments');
                                ui.initAdminChart(allAppointments);
                                console.log('‚úÖ Login de administrador bem-sucedido!');
                            } else {
                                document.getElementById('tab-admin').classList.add('hidden');
                                document.getElementById('tab-appointments').classList.remove('hidden');
                                ui.showTab('appointments-tab');
                                const { data: appointments } = await db.fetch('appointments', { userId: user.id });
                                appState.appointments = appointments;
                                ui.updateAppointmentsList(appState.appointments);
                                console.log('‚úÖ Login de usu√°rio bem-sucedido!');
                            }
                            
                            ui.hideModal();
                            ui.showMessage('login-message', 'Login bem-sucedido!', 'success');
                            
                        } else {
                            ui.showMessage('login-message', 'Senha incorreta.', 'error');
                        }
                    } else {
                        ui.showMessage('login-message', 'Usu√°rio n√£o encontrado.', 'error');
                    }
                });

                document.getElementById('register-form').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const name = document.getElementById('register_name').value;
                    const email = document.getElementById('register_email').value;
                    const phone = document.getElementById('register_phone').value;
                    const password = document.getElementById('register_password').value;

                    const { data: existingUser } = await db.fetch('users', { email: email });
                    if (existingUser && existingUser.length > 0) {
                        ui.showMessage('register-message', 'E-mail j√° cadastrado.', 'error');
                        return;
                    }

                    const newUser = {
                        name: name,
                        email: email,
                        phone: phone,
                        password: btoa(password), // Criptografia b√°sica para demonstra√ß√£o
                        role: 'user'
                    };

                    const { success } = await db.store('users', newUser);
                    if (success) {
                        ui.showMessage('register-message', 'Cadastro realizado com sucesso!', 'success');
                        setTimeout(() => {
                            document.getElementById('register-form').reset();
                            ui.showTab('login-tab');
                        }, 2000);
                    } else {
                        ui.showMessage('register-message', 'Erro ao cadastrar. Tente novamente.', 'error');
                    }
                });

                document.getElementById('schedule-form').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const form = e.target;
                    
                    const newAppointment = {
                        user_id: appState.user.id,
                        user_name: appState.user.name,
                        user_email: appState.user.email,
                        user_phone: appState.user.phone,
                        service: form.elements['service'].value,
                        vehicle: form.elements['vehicle'].value,
                        date: form.elements['date'].value,
                        time: form.elements['time'].value,
                        notes: form.elements['notes'].value,
                        status: 'Pendente'
                    };

                    const { success } = await db.store('appointments', newAppointment);

                    if (success) {
                        ui.showMessage('schedule-message', 'Agendamento confirmado!', 'success');
                        mail.sendAppointment(form);
                        appState.appointments.push(newAppointment);
                        ui.updateAppointmentsList(appState.appointments);
                        setTimeout(() => {
                            form.reset();
                            document.getElementById('appointments-list-container').classList.remove('hidden');
                            document.getElementById('schedule-form-container').classList.add('hidden');
                        }, 2000);
                    } else {
                        ui.showMessage('schedule-message', 'Erro ao agendar. Tente novamente.', 'error');
                    }
                });

                document.getElementById('contact-form').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const form = e.target;
                    const contactData = {
                        name: form.elements['user_name'].value,
                        email: form.elements['user_email'].value,
                        message: form.elements['message'].value
                    };

                    const { success } = await db.store('contacts', contactData);
                    if (success) {
                        ui.showMessage('contact-message', 'Sua mensagem foi enviada com sucesso!', 'success');
                        mail.sendContact(form);
                        setTimeout(() => form.reset(), 2000);
                    } else {
                        ui.showMessage('contact-message', 'Erro ao enviar mensagem. Tente novamente.', 'error');
                    }
                });

                // Fun√ß√µes de debug
                return {
                    // Teste para Supabase
                    testSupabase: async function() {
                        console.log('üß™ Testando Supabase...');
                        const testUser = {
                            name: 'Usu√°rio Teste',
                            email: 'teste@supabase.com',
                            phone: '11999999999',
                            password: btoa('senha123'),
                            role: 'user'
                        };
                        
                        const result = await db.store('users', testUser);
                        console.log('Resultado:', result);
                        return result;
                    },
                    
                    // Status
                    getSystemStatus: function() {
                        const status = {
                            supabaseEnabled: isSupabaseEnabled,
                            emailJSConfigured: !!EMAILJS_CONFIG.serviceID,
                            userLoggedIn: appState.isLoggedIn,
                            isAdmin: appState.isAdmin,
                            appointmentsCount: appState.appointments.length
                        };
                        console.log('üìä Status:', status);
                        return status;
                    },
                    
                    // Limpar dados
                    clearTestData: function() {
                        localStorage.removeItem('lbrothers_users');
                        localStorage.removeItem('lbrothers_appointments');
                        localStorage.removeItem('lbrothers_contacts');
                        console.log('üßπ Dados limpos');
                    }
                };
            })();

            console.log('‚úÖ Sistema L\' Brothers carregado!');
        });
    </script>
</body>
</html>
